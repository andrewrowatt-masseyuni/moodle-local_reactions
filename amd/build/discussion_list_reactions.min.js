define("local_reactions/discussion_list_reactions",["exports","core/ajax","core/templates","core/notification"],(function(_exports,_ajax,_templates,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * AMD module for read-only aggregated reactions on the forum discussion list.
   *
   * @module     local_reactions/discussion_list_reactions
   * @copyright  2026 Andrew Rowatt <A.J.Rowatt@massey.ac.nz>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification);let config={};_exports.init=cfg=>{config=cfg,loadDiscussionReactions()};const loadDiscussionReactions=async()=>{const rows=document.querySelectorAll('[data-region="discussion-list-item"]');if(!rows.length)return;const discussionIds=[];if(rows.forEach((row=>{const discussionId=parseInt(row.getAttribute("data-discussionid"));discussionId&&discussionIds.push(discussionId)})),discussionIds.length)try{const response=await _ajax.default.call([{methodname:"local_reactions_get_discussion_reactions",args:{component:config.component,itemtype:config.itemtype,discussionids:discussionIds,contextid:config.contextid}}])[0],reactionsMap={};response.items.forEach((item=>{reactionsMap[item.discussionid]=item}));for(const discussionId of discussionIds){const data=reactionsMap[discussionId]||{discussionid:discussionId,counts:[]};await renderBar(discussionId,data)}}catch(err){_notification.default.exception(err)}},renderBar=async(discussionId,data)=>{if(!data.counts.some((c=>c.count>0)))return;const row=document.querySelector('[data-region="discussion-list-item"][data-discussionid="'.concat(discussionId,'"]'));if(!row||row.querySelector('[data-region="reactions-bar"]'))return;const context=buildTemplateContext(data);try{const{html:html,js:js}=await _templates.default.renderForPromise("local_reactions/discussion_list_reactions",context),container=document.createElement("div");container.innerHTML=html;const barElement=container.firstElementChild,topicTh=row.querySelector("th.topic");if(!topicTh)return;const wrapperDiv=topicTh.querySelector(".p-3");if(!wrapperDiv)return;const badgesDiv=wrapperDiv.querySelectorAll(":scope > div")[1];badgesDiv?badgesDiv.after(barElement):wrapperDiv.appendChild(barElement),_templates.default.runTemplateJS(js)}catch(err){_notification.default.exception(err)}},buildTemplateContext=data=>{const countsMap={};data.counts.forEach((c=>{countsMap[c.emoji]=c.count}));const buttons=[];for(const[shortcode,unicode]of Object.entries(config.emojis)){const count=countsMap[shortcode]||0;buttons.push({shortcode:shortcode,unicode:unicode,count:count,hascount:count>0,selected:!1,canreact:!1})}return{buttons:buttons,canreact:!1}}}));

//# sourceMappingURL=discussion_list_reactions.min.js.map