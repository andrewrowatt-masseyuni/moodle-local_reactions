define("local_reactions/discussion_list_reactions",["exports","core/ajax","core/templates","core/notification"],(function(_exports,_ajax,_templates,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * AMD module for read-only aggregated reactions on the forum discussion list.
   *
   * @module     local_reactions/discussion_list_reactions
   * @copyright  2026 Andrew Rowatt <A.J.Rowatt@massey.ac.nz>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification);let config={};_exports.init=cfg=>{config=cfg,loadDiscussionReactions()};const insertSkeletons=rows=>{rows.forEach((row=>{if(row.querySelector('[data-region="reactions-skeleton"]'))return;const topicTh=row.querySelector("th.topic");if(!topicTh)return;const wrapperDiv=topicTh.querySelector(".p-3");if(!wrapperDiv)return;const skeleton=(()=>{const skeleton=document.createElement("div");if(skeleton.className="local-reactions-bar local-reactions-bar-compact local-reactions-skeleton d-flex flex-wrap align-items-center",skeleton.setAttribute("data-region","reactions-skeleton"),config.compactview){const pill=document.createElement("span");pill.className="local-reactions-skeleton-pill local-reactions-skeleton-pill-compact",skeleton.appendChild(pill)}else for(let i=0;i<2;i++){const pill=document.createElement("span");pill.className="local-reactions-skeleton-pill",skeleton.appendChild(pill)}return skeleton})(),badgesDiv=wrapperDiv.querySelectorAll(":scope > div")[1];badgesDiv?badgesDiv.after(skeleton):wrapperDiv.appendChild(skeleton)}))},loadDiscussionReactions=async()=>{const rows=document.querySelectorAll('[data-region="discussion-list-item"]');if(!rows.length)return;const discussionIds=[];if(rows.forEach((row=>{const discussionId=parseInt(row.getAttribute("data-discussionid"));discussionId&&discussionIds.push(discussionId)})),discussionIds.length){insertSkeletons(rows);try{const response=await _ajax.default.call([{methodname:"local_reactions_get_discussion_reactions",args:{component:config.component,itemtype:config.itemtype,discussionids:discussionIds,contextid:config.contextid}}])[0],reactionsMap={};response.items.forEach((item=>{reactionsMap[item.discussionid]=item}));for(const discussionId of discussionIds){const data=reactionsMap[discussionId]||{discussionid:discussionId,counts:[]};await renderBar(discussionId,data)}}catch(err){_notification.default.exception(err)}document.querySelectorAll('[data-region="reactions-skeleton"]').forEach((el=>el.remove()))}},renderBar=async(discussionId,data)=>{const row=document.querySelector('[data-region="discussion-list-item"][data-discussionid="'.concat(discussionId,'"]'));if(!row||row.querySelector('[data-region="reactions-bar"]'))return;const context=buildTemplateContext(data);try{const{html:html,js:js}=await _templates.default.renderForPromise("local_reactions/discussion_list_reactions",context),container=document.createElement("div");container.innerHTML=html;const barElement=container.firstElementChild,skeleton=row.querySelector('[data-region="reactions-skeleton"]');if(skeleton)skeleton.replaceWith(barElement);else{const topicTh=row.querySelector("th.topic");if(!topicTh)return;const wrapperDiv=topicTh.querySelector(".p-3");if(!wrapperDiv)return;const badgesDiv=wrapperDiv.querySelectorAll(":scope > div")[1];badgesDiv?badgesDiv.after(barElement):wrapperDiv.appendChild(barElement)}_templates.default.runTemplateJS(js)}catch(err){_notification.default.exception(err)}},buildTemplateContext=data=>{const countsMap={};data.counts.forEach((c=>{countsMap[c.emoji]=c.count}));const buttons=[];let totalCount=0;const reactedEmojis=[];for(const[shortcode,unicode]of Object.entries(config.emojis)){const count=countsMap[shortcode]||0;buttons.push({shortcode:shortcode,unicode:unicode,count:count,hascount:count>0,selected:!1,canreact:!1}),count>0&&(totalCount+=count,reactedEmojis.push({unicode:unicode}))}return{buttons:buttons,canreact:!1,compactview:config.compactview,hasanycount:totalCount>0,totalcount:totalCount,reactedEmojis:reactedEmojis,selected:!1}}}));

//# sourceMappingURL=discussion_list_reactions.min.js.map