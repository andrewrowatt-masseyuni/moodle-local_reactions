{"version":3,"file":"discussion_list_reactions.min.js","sources":["../src/discussion_list_reactions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for read-only aggregated reactions on the forum discussion list.\n *\n * Renders cached reactions instantly from IndexedDB, then refreshes from the\n * web service and animates any differences.\n *\n * @module     local_reactions/discussion_list_reactions\n * @copyright  2026 Andrew Rowatt <A.J.Rowatt@massey.ac.nz>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport * as Cache from 'local_reactions/cache';\n\n/** @var {Object} Module-level config set during init. */\nlet config = {};\n\n/** @var {number} Duration in ms to keep animation classes before removal. */\nconst ANIMATION_TIMEOUT = 2100;\n\n/**\n * Initialise the discussion list reactions module.\n *\n * @param {Object} cfg Configuration from PHP.\n */\nexport const init = (cfg) => {\n    config = cfg;\n    loadDiscussionReactions();\n};\n\n/**\n * Create a skeleton placeholder element for a discussion list reactions bar.\n *\n * @returns {HTMLElement} The skeleton element.\n */\nconst createSkeleton = () => {\n    const skeleton = document.createElement('div');\n    skeleton.className =\n        'local-reactions-bar local-reactions-bar-compact local-reactions-skeleton d-flex flex-wrap align-items-center';\n    skeleton.setAttribute('data-region', 'reactions-skeleton');\n    if (config.compactview) {\n        const pill = document.createElement('span');\n        pill.className = 'local-reactions-skeleton-pill local-reactions-skeleton-pill-compact';\n        skeleton.appendChild(pill);\n    } else {\n        for (let i = 0; i < 2; i++) {\n            const pill = document.createElement('span');\n            pill.className = 'local-reactions-skeleton-pill';\n            skeleton.appendChild(pill);\n        }\n    }\n    return skeleton;\n};\n\n/**\n * Insert skeleton placeholders into discussion rows.\n *\n * @param {HTMLElement[]} rows The discussion list item elements.\n */\nconst insertSkeletons = (rows) => {\n    rows.forEach((row) => {\n        if (row.querySelector('[data-region=\"reactions-skeleton\"]')) {\n            return;\n        }\n        const topicTh = row.querySelector('th.topic');\n        if (!topicTh) {\n            return;\n        }\n        const wrapperDiv = topicTh.querySelector('.p-3');\n        if (!wrapperDiv) {\n            return;\n        }\n        const skeleton = createSkeleton();\n        const childDivs = wrapperDiv.querySelectorAll(':scope > div');\n        const badgesDiv = childDivs[1];\n        if (badgesDiv) {\n            badgesDiv.after(skeleton);\n        } else {\n            wrapperDiv.appendChild(skeleton);\n        }\n    });\n};\n\n/**\n * Remove all remaining skeleton placeholders from the page.\n */\nconst removeSkeletons = () => {\n    document.querySelectorAll('[data-region=\"reactions-skeleton\"]').forEach((el) => el.remove());\n};\n\n/**\n * Find all discussion rows on the page and load their aggregated reactions.\n *\n * Uses a cache-first strategy: renders cached counts instantly, then fetches\n * fresh data from the web service and animates any differences.\n */\nconst loadDiscussionReactions = async() => {\n    const rows = document.querySelectorAll('[data-region=\"discussion-list-item\"]');\n    if (!rows.length) {\n        return;\n    }\n\n    const discussionIds = [];\n    rows.forEach((row) => {\n        const discussionId = parseInt(row.getAttribute('data-discussionid'));\n        if (discussionId) {\n            discussionIds.push(discussionId);\n        }\n    });\n\n    if (!discussionIds.length) {\n        return;\n    }\n\n    // Phase 1: Pre-render cached bars off-DOM (all async work before any DOM mutations).\n    const cachedDiscussionIds = new Set();\n    const cachedDataMap = {};\n    const cacheAvailable = await Cache.isAvailable();\n    const preRenderedBars = [];\n\n    if (cacheAvailable) {\n        const cacheKeys = discussionIds.map((id) => Cache.discussionKey(config.component, config.itemtype, id));\n        const cached = await Cache.getMultiple(cacheKeys);\n\n        for (const discussionId of discussionIds) {\n            const key = Cache.discussionKey(config.component, config.itemtype, discussionId);\n            const cachedData = cached.get(key);\n            if (cachedData) {\n                cachedDataMap[discussionId] = cachedData;\n                cachedDiscussionIds.add(discussionId);\n                try {\n                    const context = buildTemplateContext(cachedData);\n                    const {html, js} = await Templates.renderForPromise(\n                        'local_reactions/discussion_list_reactions', context\n                    );\n                    const container = document.createElement('div');\n                    container.innerHTML = html;\n                    const barElement = container.firstElementChild;\n                    barElement.setAttribute('data-source', 'cache');\n                    preRenderedBars.push({discussionId, barElement, js});\n                } catch (err) {\n                    cachedDiscussionIds.delete(discussionId);\n                    delete cachedDataMap[discussionId];\n                }\n            }\n        }\n    }\n\n    // Phase 2: Synchronous DOM batch - remove reservation, insert cached bars and skeletons\n    // in one go so the browser repaints only once (no gap, no double-height).\n    document.getElementById('local-reactions-reserve')?.remove();\n\n    for (const {discussionId, barElement, js} of preRenderedBars) {\n        const row = document.querySelector(\n            `[data-region=\"discussion-list-item\"][data-discussionid=\"${discussionId}\"]`\n        );\n        if (!row || row.querySelector('[data-region=\"reactions-bar\"]')) {\n            continue;\n        }\n        const topicTh = row.querySelector('th.topic');\n        if (!topicTh) {\n            continue;\n        }\n        const wrapperDiv = topicTh.querySelector('.p-3');\n        if (!wrapperDiv) {\n            continue;\n        }\n        const childDivs = wrapperDiv.querySelectorAll(':scope > div');\n        const badgesDiv = childDivs[1];\n        if (badgesDiv) {\n            badgesDiv.after(barElement);\n        } else {\n            wrapperDiv.appendChild(barElement);\n        }\n        Templates.runTemplateJS(js);\n    }\n\n    const uncachedRows = [...rows].filter((row) => {\n        const id = parseInt(row.getAttribute('data-discussionid'));\n        return !cachedDiscussionIds.has(id);\n    });\n    if (uncachedRows.length > 0) {\n        insertSkeletons(uncachedRows);\n    }\n\n    // Phase 3: Fetch fresh data from web service (for ALL discussions).\n    try {\n        const response = await Ajax.call([{\n            methodname: 'local_reactions_get_discussion_reactions',\n            args: {\n                component: config.component,\n                itemtype: config.itemtype,\n                discussionids: discussionIds,\n                contextid: config.contextid,\n            },\n        }])[0];\n\n        const reactionsMap = {};\n        response.items.forEach((item) => {\n            reactionsMap[item.discussionid] = item;\n        });\n\n        // Phase 4: Update UI and cache.\n        const cacheEntries = [];\n\n        for (const discussionId of discussionIds) {\n            const freshData = reactionsMap[discussionId] || {discussionid: discussionId, counts: []};\n\n            if (cachedDiscussionIds.has(discussionId)) {\n                // This discussion was rendered from cache - compute diffs and re-render with animation.\n                const diffs = computeDiffs(cachedDataMap[discussionId], freshData);\n                if (diffs.hasChanges) {\n                    await rerenderBarWithAnimation(discussionId, freshData, diffs);\n                } else {\n                    // No count changes - just update data-source to live.\n                    const row = document.querySelector(\n                        `[data-region=\"discussion-list-item\"][data-discussionid=\"${discussionId}\"]`\n                    );\n                    const bar = row?.querySelector('[data-region=\"reactions-bar\"]');\n                    if (bar) {\n                        bar.setAttribute('data-source', 'live');\n                    }\n                }\n            } else {\n                // This discussion was not cached - render normally (replaces skeleton).\n                await renderBar(discussionId, freshData, false);\n            }\n\n            if (cacheAvailable) {\n                cacheEntries.push({\n                    key: Cache.discussionKey(config.component, config.itemtype, discussionId),\n                    data: {counts: freshData.counts || []},\n                });\n            }\n        }\n\n        if (cacheEntries.length > 0) {\n            await Cache.setMultiple(cacheEntries);\n        }\n    } catch (err) {\n        Notification.exception(err);\n    }\n\n    removeSkeletons();\n};\n\n/**\n * Build the template context and render the read-only reactions bar into a discussion row.\n *\n * @param {number} discussionId The forum discussion ID.\n * @param {Object} data Reaction data from the web service.\n * @param {boolean} fromCache Whether this render is from cached data.\n */\nconst renderBar = async(discussionId, data, fromCache) => {\n    const row = document.querySelector(\n        `[data-region=\"discussion-list-item\"][data-discussionid=\"${discussionId}\"]`\n    );\n    if (!row || row.querySelector('[data-region=\"reactions-bar\"]')) {\n        return;\n    }\n\n    const context = buildTemplateContext(data);\n\n    try {\n        const {html, js} = await Templates.renderForPromise('local_reactions/discussion_list_reactions', context);\n        const container = document.createElement('div');\n        container.innerHTML = html;\n        const barElement = container.firstElementChild;\n        barElement.setAttribute('data-source', fromCache ? 'cache' : 'live');\n\n        // Replace skeleton if present, otherwise insert at the usual location.\n        const skeleton = row.querySelector('[data-region=\"reactions-skeleton\"]');\n        if (skeleton) {\n            skeleton.replaceWith(barElement);\n        } else {\n            const topicTh = row.querySelector('th.topic');\n            if (!topicTh) {\n                return;\n            }\n            const wrapperDiv = topicTh.querySelector('.p-3');\n            if (!wrapperDiv) {\n                return;\n            }\n            const childDivs = wrapperDiv.querySelectorAll(':scope > div');\n            const badgesDiv = childDivs[1];\n            if (badgesDiv) {\n                badgesDiv.after(barElement);\n            } else {\n                wrapperDiv.appendChild(barElement);\n            }\n        }\n        Templates.runTemplateJS(js);\n    } catch (err) {\n        Notification.exception(err);\n    }\n};\n\n/**\n * Compare cached and fresh reaction data to find differences.\n *\n * @param {Object} cachedData Cached reaction data (counts only).\n * @param {Object} freshData Fresh reaction data from web service.\n * @returns {Object} Diffs object.\n */\nconst computeDiffs = (cachedData, freshData) => {\n    const cachedCounts = {};\n    (cachedData?.counts || []).forEach((c) => {\n        cachedCounts[c.emoji] = c.count;\n    });\n\n    const freshCounts = {};\n    (freshData?.counts || []).forEach((c) => {\n        freshCounts[c.emoji] = c.count;\n    });\n\n    const changedEmojis = new Set();\n    const newEmojis = new Set();\n    const removedEmojis = new Set();\n\n    for (const emoji of Object.keys(freshCounts)) {\n        if (!(emoji in cachedCounts)) {\n            if (freshCounts[emoji] > 0) {\n                newEmojis.add(emoji);\n            }\n        } else if (freshCounts[emoji] !== cachedCounts[emoji]) {\n            changedEmojis.add(emoji);\n        }\n    }\n\n    for (const emoji of Object.keys(cachedCounts)) {\n        if (cachedCounts[emoji] > 0 && (!(emoji in freshCounts) || freshCounts[emoji] === 0)) {\n            removedEmojis.add(emoji);\n        }\n    }\n\n    const hasChanges = changedEmojis.size > 0 || newEmojis.size > 0 || removedEmojis.size > 0;\n\n    return {hasChanges, changedEmojis, newEmojis, removedEmojis};\n};\n\n/**\n * Re-render a discussion reactions bar with animation for changed counts.\n *\n * @param {number} discussionId The forum discussion ID.\n * @param {Object} freshData Fresh reaction data from the web service.\n * @param {Object} diffs The diff result from computeDiffs.\n */\nconst rerenderBarWithAnimation = async(discussionId, freshData, diffs) => {\n    const row = document.querySelector(\n        `[data-region=\"discussion-list-item\"][data-discussionid=\"${discussionId}\"]`\n    );\n    if (!row) {\n        return;\n    }\n\n    const existingBar = row.querySelector('[data-region=\"reactions-bar\"]');\n    if (!existingBar) {\n        return;\n    }\n\n    const context = buildTemplateContext(freshData);\n\n    try {\n        const {html, js} = await Templates.renderForPromise('local_reactions/discussion_list_reactions', context);\n        const container = document.createElement('div');\n        container.innerHTML = html;\n        const newBar = container.firstElementChild;\n        newBar.setAttribute('data-source', 'live');\n\n        // Apply animation classes to changed pills.\n        if (!config.compactview) {\n            newBar.querySelectorAll('[data-emoji]').forEach((pill) => {\n                const emoji = pill.getAttribute('data-emoji');\n                if (diffs.changedEmojis.has(emoji)) {\n                    pill.classList.add('local-reactions-count-changed');\n                }\n                if (diffs.newEmojis.has(emoji)) {\n                    pill.classList.add('local-reactions-pill-new');\n                }\n            });\n        } else {\n            const compactPill = newBar.querySelector('.local-reactions-pill-compact');\n            if (compactPill) {\n                compactPill.classList.add('local-reactions-count-changed');\n            }\n        }\n\n        existingBar.replaceWith(newBar);\n        Templates.runTemplateJS(js);\n\n        // Remove animation classes after animation completes.\n        setTimeout(() => {\n            newBar.querySelectorAll('.local-reactions-count-changed, .local-reactions-pill-new')\n                .forEach((el) => {\n                    el.classList.remove('local-reactions-count-changed', 'local-reactions-pill-new');\n                });\n        }, ANIMATION_TIMEOUT);\n    } catch (err) {\n        Notification.exception(err);\n    }\n};\n\n/**\n * Build Mustache template context from aggregated reaction data.\n *\n * All pills are read-only: canreact is false, selected is false for all.\n *\n * @param {Object} data Reaction data.\n * @returns {Object} Template context.\n */\nconst buildTemplateContext = (data) => {\n    const countsMap = {};\n    data.counts.forEach((c) => {\n        countsMap[c.emoji] = c.count;\n    });\n\n    const buttons = [];\n    let totalCount = 0;\n    const reactedEmojis = [];\n\n    for (const [shortcode, unicode] of Object.entries(config.emojis)) {\n        const count = countsMap[shortcode] || 0;\n        buttons.push({\n            shortcode: shortcode,\n            unicode: unicode,\n            count: count,\n            hascount: count > 0,\n            selected: false,\n            canreact: false,\n        });\n        if (count > 0) {\n            totalCount += count;\n            reactedEmojis.push({unicode: unicode});\n        }\n    }\n\n    return {\n        buttons: buttons,\n        canreact: false,\n        compactview: config.compactview,\n        hasanycount: totalCount > 0,\n        totalcount: totalCount,\n        reactedEmojis: reactedEmojis,\n        selected: false,\n    };\n};\n"],"names":["config","cfg","loadDiscussionReactions","insertSkeletons","rows","forEach","row","querySelector","topicTh","wrapperDiv","skeleton","document","createElement","className","setAttribute","compactview","pill","appendChild","i","createSkeleton","badgesDiv","querySelectorAll","after","async","length","discussionIds","discussionId","parseInt","getAttribute","push","cachedDiscussionIds","Set","cachedDataMap","cacheAvailable","Cache","isAvailable","preRenderedBars","cacheKeys","map","id","discussionKey","component","itemtype","cached","getMultiple","key","cachedData","get","add","context","buildTemplateContext","html","js","Templates","renderForPromise","container","innerHTML","barElement","firstElementChild","err","delete","getElementById","remove","runTemplateJS","uncachedRows","filter","has","response","Ajax","call","methodname","args","discussionids","contextid","reactionsMap","items","item","discussionid","cacheEntries","freshData","counts","diffs","computeDiffs","hasChanges","rerenderBarWithAnimation","bar","renderBar","data","setMultiple","exception","el","fromCache","replaceWith","cachedCounts","c","emoji","count","freshCounts","changedEmojis","newEmojis","removedEmojis","Object","keys","size","existingBar","newBar","compactPill","classList","setTimeout","countsMap","buttons","totalCount","reactedEmojis","shortcode","unicode","entries","emojis","hascount","selected","canreact","hasanycount","totalcount"],"mappings":"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"}