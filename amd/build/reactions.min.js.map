{"version":3,"file":"reactions.min.js","sources":["../src/reactions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for emoji reactions on forum posts (GitHub-style picker).\n *\n * Renders cached reactions instantly from IndexedDB, then refreshes from the\n * web service and animates any differences.\n *\n * @module     local_reactions/reactions\n * @copyright  2026 Andrew Rowatt <A.J.Rowatt@massey.ac.nz>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport * as Cache from 'local_reactions/cache';\nimport {\n    computeDiffs, renderToElement, buildTemplateContext, createPoller, collectIds,\n    applyDiffAnimations, clearAnimationClasses, updateCacheBatch,\n} from 'local_reactions/utils';\n\n/** @var {Object} Module-level config set during init. */\nlet config = {};\n\n/** @var {Object} Tracks last-rendered reaction data per post ID for diff computation during polling. */\nlet currentDataMap = {};\n\n/** @var {boolean} Whether a toggle request is in-flight (prevents poll from racing with toggle). */\nlet toggleInProgress = false;\n\n/** @var {boolean} Whether polling has been initialised. */\nlet pollingInitialised = false;\n\n/**\n * Initialise the reactions module.\n *\n * @param {Object} cfg Configuration from PHP.\n */\nexport const init = (cfg) => {\n    config = cfg;\n    loadReactions();\n\n    // Close any open picker when clicking outside.\n    document.addEventListener('click', (e) => {\n        if (!e.target.closest('.local-reactions-picker-wrapper')) {\n            closeAllPickers();\n        }\n    });\n\n    // Re-load when new replies are dynamically added.\n    const container = document.querySelector('[data-content=\"forum-discussion\"]');\n    if (container) {\n        const observer = new MutationObserver((mutations) => {\n            for (const mutation of mutations) {\n                for (const node of mutation.addedNodes) {\n                    if (node.nodeType === Node.ELEMENT_NODE && node.querySelector('article[data-post-id]')) {\n                        loadReactions();\n                        return;\n                    }\n                }\n            }\n        });\n        observer.observe(container, {childList: true, subtree: true});\n    }\n};\n\n/**\n * Close all open emoji pickers.\n */\nconst closeAllPickers = () => {\n    document.querySelectorAll('[data-region=\"reactions-picker\"]:not([hidden])').forEach((picker) => {\n        picker.hidden = true;\n        const trigger = picker.closest('.local-reactions-picker-wrapper')\n            ?.querySelector('[data-action=\"open-picker\"]');\n        if (trigger) {\n            trigger.setAttribute('aria-expanded', 'false');\n        }\n    });\n};\n\n/**\n * Insert an element before the post actions container, or append to post core.\n *\n * @param {HTMLElement} article The article element.\n * @param {HTMLElement} element The element to insert.\n */\nconst insertBeforeActions = (article, element) => {\n    const actionsContainer = article.querySelector('[data-region=\"post-actions-container\"]');\n    if (actionsContainer) {\n        actionsContainer.parentElement.insertBefore(element, actionsContainer);\n    } else {\n        const postCore = article.querySelector('[data-region-content=\"forum-post-core\"]');\n        if (postCore) {\n            postCore.appendChild(element);\n        }\n    }\n};\n\n/**\n * Create a skeleton placeholder element for a reactions bar.\n *\n * @returns {HTMLElement} The skeleton element.\n */\nconst createSkeleton = () => {\n    const skeleton = document.createElement('div');\n    skeleton.className = 'local-reactions-bar local-reactions-skeleton d-flex flex-wrap align-items-center mt-2 mb-1';\n    skeleton.setAttribute('data-region', 'reactions-skeleton');\n    if (config.compactview) {\n        const pill = document.createElement('span');\n        pill.className = 'local-reactions-skeleton-pill local-reactions-skeleton-pill-compact';\n        skeleton.appendChild(pill);\n    } else {\n        for (let i = 0; i < 3; i++) {\n            const pill = document.createElement('span');\n            pill.className = 'local-reactions-skeleton-pill';\n            skeleton.appendChild(pill);\n        }\n    }\n    return skeleton;\n};\n\n/**\n * Insert skeleton placeholders into articles that don't yet have a reactions bar.\n *\n * @param {number[]} postIds The post IDs to insert skeletons for.\n */\nconst insertSkeletons = (postIds) => {\n    for (const postId of postIds) {\n        const article = document.querySelector(`article[data-post-id=\"${postId}\"]`);\n        if (!article || article.querySelector('[data-region=\"reactions-skeleton\"]')) {\n            continue;\n        }\n        insertBeforeActions(article, createSkeleton());\n    }\n};\n\n/**\n * Find all forum post articles on the page and load their reactions.\n *\n * Uses a cache-first strategy: renders cached counts instantly (read-only),\n * then fetches fresh data from the web service and animates any differences.\n */\nconst loadReactions = async() => {\n    const articles = document.querySelectorAll('article[data-post-id]');\n    if (!articles.length) {\n        return;\n    }\n\n    const postIds = [];\n    articles.forEach((article) => {\n        const postId = parseInt(article.getAttribute('data-post-id'));\n        if (postId && !article.querySelector('[data-region=\"reactions-bar\"]')) {\n            postIds.push(postId);\n        }\n    });\n\n    if (!postIds.length) {\n        return;\n    }\n\n    // Phase 1: Try to render from cache (read-only, no interaction).\n    const cachedPostIds = new Set();\n    const cachedDataMap = {};\n    const cacheAvailable = await Cache.isAvailable();\n\n    if (cacheAvailable) {\n        const cacheKeys = postIds.map((id) => Cache.itemKey(config.component, config.itemtype, id));\n        const cached = await Cache.getMultiple(cacheKeys);\n\n        const renderPromises = [];\n        for (const postId of postIds) {\n            const key = Cache.itemKey(config.component, config.itemtype, postId);\n            const cachedData = cached.get(key);\n            if (cachedData) {\n                cachedDataMap[postId] = cachedData;\n                cachedPostIds.add(postId);\n                renderPromises.push(renderBar(postId, cachedData, true));\n            }\n        }\n        await Promise.all(renderPromises);\n    }\n\n    // Phase 2: Remove CSS reserve skeleton and insert JS skeletons for uncached posts.\n    document.getElementById('local-reactions-reserve')?.remove();\n    const uncachedPostIds = postIds.filter((id) => !cachedPostIds.has(id));\n    if (uncachedPostIds.length > 0) {\n        insertSkeletons(uncachedPostIds);\n    }\n\n    // Phase 3: Fetch fresh data from web service (for ALL posts).\n    try {\n        const response = await Ajax.call([{\n            methodname: 'local_reactions_get_reactions',\n            args: {\n                component: config.component,\n                itemtype: config.itemtype,\n                itemids: postIds,\n                contextid: config.contextid,\n            },\n        }])[0];\n\n        const reactionsMap = {};\n        response.items.forEach((item) => {\n            reactionsMap[item.itemid] = item;\n        });\n\n        // Phase 4: Update UI and cache.\n        for (const postId of postIds) {\n            const freshData = reactionsMap[postId] || {itemid: postId, userreactions: [], counts: []};\n\n            if (cachedPostIds.has(postId)) {\n                // This post was rendered from cache - compute diffs and re-render with animation.\n                const diffs = computeDiffs(cachedDataMap[postId], freshData);\n                await rerenderBarWithAnimation(postId, freshData, diffs);\n            } else {\n                // This post was not cached - render normally (replaces skeleton).\n                await renderBar(postId, freshData, false);\n            }\n\n            currentDataMap[postId] = freshData;\n        }\n\n        await updateCacheBatch(\n            postIds,\n            (id) => Cache.itemKey(config.component, config.itemtype, id),\n            currentDataMap,\n        );\n    } catch (err) {\n        Notification.exception(err);\n    }\n\n    if (!pollingInitialised) {\n        pollingInitialised = true;\n        createPoller(config.pollinterval, pollReactions);\n    }\n};\n\n/**\n * Build the template context and render the reactions bar into a post.\n *\n * @param {number} postId The forum post ID.\n * @param {Object} data Reaction data.\n * @param {boolean} fromCache Whether this render is from cached data (read-only).\n */\nconst renderBar = async(postId, data, fromCache) => {\n    const article = document.querySelector(`article[data-post-id=\"${postId}\"]`);\n    if (!article || article.querySelector('[data-region=\"reactions-bar\"]')) {\n        return;\n    }\n\n    const context = buildTemplateContext(data, config.emojis, {\n        canreact: config.canreact,\n        compactview: config.compactview,\n        userreactions: fromCache ? [] : (data.userreactions || []),\n    });\n\n    try {\n        const {element: barElement, js} = await renderToElement('local_reactions/reactions_bar', context);\n        barElement.setAttribute('data-source', fromCache ? 'cache' : 'live');\n\n        // Replace skeleton if present, otherwise insert at the usual location.\n        const skeleton = article.querySelector('[data-region=\"reactions-skeleton\"]');\n        if (skeleton) {\n            skeleton.replaceWith(barElement);\n        } else {\n            insertBeforeActions(article, barElement);\n        }\n        Templates.runTemplateJS(js);\n        if (fromCache) {\n            // Disable all buttons so the picker and pills are visible but non-interactive.\n            barElement.querySelectorAll('button').forEach((b) => b.setAttribute('disabled', 'disabled'));\n        } else {\n            bindHandlers(barElement, postId);\n        }\n    } catch (err) {\n        Notification.exception(err);\n    }\n};\n\n/**\n * Re-render a reactions bar with animation for changed counts.\n *\n * Always re-renders to enable interaction (cache renders are read-only).\n *\n * @param {number} postId The forum post ID.\n * @param {Object} freshData Fresh reaction data from the web service.\n * @param {Object} diffs The diff result from computeDiffs.\n */\nconst rerenderBarWithAnimation = async(postId, freshData, diffs) => {\n    const article = document.querySelector(`article[data-post-id=\"${postId}\"]`);\n    if (!article) {\n        return;\n    }\n\n    const existingBar = article.querySelector('[data-region=\"reactions-bar\"]');\n    if (!existingBar) {\n        return;\n    }\n\n    const context = buildTemplateContext(freshData, config.emojis, {\n        canreact: config.canreact,\n        compactview: config.compactview,\n        userreactions: freshData.userreactions || [],\n    });\n\n    try {\n        const {element: newBar, js} = await renderToElement('local_reactions/reactions_bar', context);\n        newBar.setAttribute('data-source', 'live');\n\n        applyDiffAnimations(newBar, diffs, config.compactview);\n\n        existingBar.replaceWith(newBar);\n        Templates.runTemplateJS(js);\n        bindHandlers(newBar, postId);\n\n        if (diffs.hasChanges) {\n            clearAnimationClasses(newBar);\n        }\n    } catch (err) {\n        Notification.exception(err);\n    }\n};\n\n/**\n * Bind all event handlers for a reactions bar.\n *\n * @param {HTMLElement} barElement The reactions bar container.\n * @param {number} postId The forum post ID.\n */\nconst bindHandlers = (barElement, postId) => {\n    // Picker trigger buttons (smiley trigger and compact pill both use data-action=\"open-picker\").\n    barElement.querySelectorAll('[data-action=\"open-picker\"]').forEach((trigger) => {\n        trigger.addEventListener('click', (e) => {\n            e.stopPropagation();\n            const picker = barElement.querySelector('[data-region=\"reactions-picker\"]');\n            if (!picker) {\n                return;\n            }\n            const isOpen = !picker.hidden;\n            closeAllPickers();\n            if (!isOpen) {\n                // Position the picker using fixed coordinates to escape overflow:hidden parents.\n                const rect = trigger.getBoundingClientRect();\n                picker.style.left = rect.left + 'px';\n                picker.style.top = (rect.top - picker.offsetHeight - 6) + 'px';\n                picker.hidden = false;\n                // Re-calculate now that it's visible and has a real height.\n                picker.style.top = (rect.top - picker.offsetHeight - 6) + 'px';\n                trigger.setAttribute('aria-expanded', 'true');\n            }\n        });\n    });\n\n    // All toggle-reaction buttons (pills + picker buttons).\n    if (config.canreact) {\n        barElement.querySelectorAll('[data-action=\"toggle-reaction\"]').forEach((btn) => {\n            btn.addEventListener('click', async(e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                closeAllPickers();\n                const emoji = btn.getAttribute('data-emoji');\n                await toggleReaction(postId, emoji, barElement);\n            });\n        });\n    }\n};\n\n/**\n * Toggle a reaction via the web service and rebuild the bar.\n *\n * @param {number} postId The forum post ID.\n * @param {string} emoji The emoji shortcode.\n * @param {HTMLElement} barElement The reactions bar to replace.\n */\nconst toggleReaction = async(postId, emoji, barElement) => {\n    // Disable all interactive elements during the request.\n    barElement.querySelectorAll('button').forEach((b) => b.setAttribute('disabled', 'disabled'));\n    toggleInProgress = true;\n\n    try {\n        const response = await Ajax.call([{\n            methodname: 'local_reactions_toggle_reaction',\n            args: {\n                component: config.component,\n                itemtype: config.itemtype,\n                itemid: postId,\n                emoji: emoji,\n            },\n        }])[0];\n\n        const freshData = {\n            userreactions: response.userreactions,\n            counts: response.counts,\n        };\n\n        // Rebuild the bar with fresh data to correctly show/hide pills.\n        const context = buildTemplateContext(freshData, config.emojis, {\n            canreact: config.canreact,\n            compactview: config.compactview,\n            userreactions: freshData.userreactions || [],\n        });\n        const {element: newBar, js} = await renderToElement('local_reactions/reactions_bar', context);\n        newBar.setAttribute('data-source', 'live');\n\n        barElement.replaceWith(newBar);\n        Templates.runTemplateJS(js);\n        bindHandlers(newBar, postId);\n\n        currentDataMap[postId] = freshData;\n\n        await updateCacheBatch(\n            [postId],\n            (id) => Cache.itemKey(config.component, config.itemtype, id),\n            currentDataMap,\n        );\n    } catch (err) {\n        Notification.exception(err);\n        // Re-enable buttons on error.\n        barElement.querySelectorAll('button').forEach((b) => b.removeAttribute('disabled'));\n    } finally {\n        toggleInProgress = false;\n    }\n};\n\n/**\n * Poll the server for updated reaction data and animate any changes.\n */\nconst pollReactions = async() => {\n    if (toggleInProgress) {\n        return;\n    }\n\n    const postIds = collectIds('article[data-post-id]', 'data-post-id');\n    if (!postIds.length) {\n        return;\n    }\n\n    try {\n        const response = await Ajax.call([{\n            methodname: 'local_reactions_get_reactions',\n            args: {\n                component: config.component,\n                itemtype: config.itemtype,\n                itemids: postIds,\n                contextid: config.contextid,\n            },\n        }])[0];\n\n        const reactionsMap = {};\n        response.items.forEach((item) => {\n            reactionsMap[item.itemid] = item;\n        });\n\n        for (const postId of postIds) {\n            const freshData = reactionsMap[postId] || {itemid: postId, userreactions: [], counts: []};\n            const previousData = currentDataMap[postId];\n\n            if (previousData) {\n                const diffs = computeDiffs(previousData, freshData);\n                if (diffs.hasChanges) {\n                    await rerenderBarWithAnimation(postId, freshData, diffs);\n                }\n            }\n\n            currentDataMap[postId] = freshData;\n        }\n\n        await updateCacheBatch(\n            postIds,\n            (id) => Cache.itemKey(config.component, config.itemtype, id),\n            currentDataMap,\n        );\n    } catch {\n        // Silently ignore poll errors to avoid disrupting the user.\n    }\n};\n"],"names":["config","currentDataMap","toggleInProgress","pollingInitialised","cfg","loadReactions","document","addEventListener","e","target","closest","closeAllPickers","container","querySelector","MutationObserver","mutations","mutation","node","addedNodes","nodeType","Node","ELEMENT_NODE","observe","childList","subtree","querySelectorAll","forEach","picker","hidden","trigger","_picker$closest","setAttribute","insertBeforeActions","article","element","actionsContainer","parentElement","insertBefore","postCore","appendChild","createSkeleton","skeleton","createElement","className","compactview","pill","i","async","articles","length","postIds","postId","parseInt","getAttribute","push","cachedPostIds","Set","cachedDataMap","Cache","isAvailable","cacheKeys","map","id","itemKey","component","itemtype","cached","getMultiple","renderPromises","key","cachedData","get","add","renderBar","Promise","all","getElementById","remove","uncachedPostIds","filter","has","insertSkeletons","response","Ajax","call","methodname","args","itemids","contextid","reactionsMap","items","item","itemid","freshData","userreactions","counts","diffs","rerenderBarWithAnimation","err","exception","pollinterval","pollReactions","data","fromCache","context","emojis","canreact","barElement","js","replaceWith","runTemplateJS","b","bindHandlers","existingBar","newBar","hasChanges","stopPropagation","isOpen","rect","getBoundingClientRect","style","left","top","offsetHeight","btn","preventDefault","emoji","toggleReaction","removeAttribute","previousData"],"mappings":"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"}