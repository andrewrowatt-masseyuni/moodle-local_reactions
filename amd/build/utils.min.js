define("local_reactions/utils",["exports","core/templates"],(function(_exports,_templates){var obj;
/**
   * Shared utilities for emoji reactions modules.
   *
   * @module     local_reactions/utils
   * @copyright  2026 Andrew Rowatt <A.J.Rowatt@massey.ac.nz>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.renderToElement=_exports.createPoller=_exports.computeDiffs=_exports.collectIds=_exports.buildTemplateContext=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};_exports.renderToElement=async(templateName,context)=>{const{html:html,js:js}=await _templates.default.renderForPromise(templateName,context),container=document.createElement("div");return container.innerHTML=html,{element:container.firstElementChild,js:js}};_exports.computeDiffs=(cachedData,freshData)=>{const cachedCounts={};((null==cachedData?void 0:cachedData.counts)||[]).forEach((c=>{cachedCounts[c.emoji]=c.count}));const freshCounts={};((null==freshData?void 0:freshData.counts)||[]).forEach((c=>{freshCounts[c.emoji]=c.count}));const changedEmojis=new Set,newEmojis=new Set,removedEmojis=new Set;for(const emoji of Object.keys(freshCounts))emoji in cachedCounts?freshCounts[emoji]!==cachedCounts[emoji]&&changedEmojis.add(emoji):freshCounts[emoji]>0&&newEmojis.add(emoji);for(const emoji of Object.keys(cachedCounts))cachedCounts[emoji]>0&&(!(emoji in freshCounts)||0===freshCounts[emoji])&&removedEmojis.add(emoji);return{hasChanges:changedEmojis.size>0||newEmojis.size>0||removedEmojis.size>0,changedEmojis:changedEmojis,newEmojis:newEmojis,removedEmojis:removedEmojis}};_exports.buildTemplateContext=function(data,emojis){let{canreact:canreact=!1,compactview:compactview=!1,userreactions:userreactions=[]}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const countsMap={};data.counts.forEach((c=>{countsMap[c.emoji]=c.count}));const buttons=[];let totalCount=0;const reactedEmojis=[];let hasAnySelected=!1;for(const[shortcode,unicode]of Object.entries(emojis)){const count=countsMap[shortcode]||0,isSelected=userreactions.includes(shortcode);buttons.push({shortcode:shortcode,unicode:unicode,count:count,hascount:count>0,selected:isSelected,canreact:canreact}),count>0&&(totalCount+=count,reactedEmojis.push({unicode:unicode}),isSelected&&(hasAnySelected=!0))}return{buttons:buttons,canreact:canreact,compactview:compactview,hasanycount:totalCount>0,totalcount:totalCount,reactedEmojis:reactedEmojis,selected:hasAnySelected}};_exports.createPoller=(intervalSeconds,pollFn)=>{if(!intervalSeconds||intervalSeconds<=0)return;let timer=setInterval(pollFn,1e3*intervalSeconds);document.addEventListener("visibilitychange",(()=>{document.hidden?timer&&(clearInterval(timer),timer=null):timer||(pollFn(),timer=setInterval(pollFn,1e3*intervalSeconds))}))};_exports.collectIds=(selector,attribute)=>{const ids=[];return document.querySelectorAll(selector).forEach((el=>{const id=parseInt(el.getAttribute(attribute));id&&ids.push(id)})),ids}}));

//# sourceMappingURL=utils.min.js.map